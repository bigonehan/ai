---
name: check-code
description: "코드 점검 및 개선을 요구할때 사용하는 skill"
---
# 기본 규칙 
- 요구사항/성공 기준이 코드 동작과 일치하는가?
- 계산 함수가 숨은 입력(전역/시간/랜덤/DOM)에 의존하지 않는가?
- 계산 함수가 숨은 출력(전역 변경/인자 mutation)을 만들지 않는가?
- 액션과 계산이 파일/함수 레벨에서 명확히 분리되었는가?
- 데이터 갱신이 Copy-on-Write로 구현되었는가?
- 불필요한 기능/설정/추상화를 추가하지 않았는가?
- `.project` 폴더가 있는 경우 관련 YAML 규칙을 구현/검증 체크리스트에 반영했는가?

---

## PHASE 1: 전역 상태 분류

```
Q1. 전역으로 선언된 변수/객체가 있는가?
A1. [있음 / 없음 — 있으면 목록화]

Q2. 각 전역이 const + freeze로 불변이 보장되는가, 아니면 변경 가능한가?
A2. [DATA 목록] / [MUTABLE GLOBAL 목록]
```

→ MUTABLE GLOBAL이 있으면 PHASE 2에서 반드시 검출된다.

---

## PHASE 2: 액션 / 계산 분류

코드의 모든 함수를 대상으로 아래 질문에 답한다.

```
Q3. 각 함수가 MUTABLE GLOBAL을 읽거나 쓰는가?
A3. [함수명: 읽음/씀/없음]

Q4. 각 함수가 DOM 읽기/쓰기, console.log, fetch, DB 호출, Math.random(), new Date()를 포함하는가?
A4. [함수명: 포함/미포함]

Q5. 각 함수가 다른 액션을 호출하는가?
A5. [함수명: 호출함/안함]
```

→ Q3~Q5 중 하나라도 "해당"이면 → 액션(ACTION)으로 표시
→ 모두 "없음/미포함/안함"이면 → 계산(CALCULATION)으로 표시

---

## PHASE 3: 계산 함수 순수성 검증

계산으로 분류된 함수만 대상으로 한다.

```
Q6. 인자로 받은 배열/객체를 push, pop, shift, splice, sort, reverse, obj[key]=... 등으로 직접 수정하는가?
A6. [함수명: 수정함 / 수정안함]

Q7. 중첩 구조를 업데이트할 때 변경 경로의 모든 레벨을 복사하는가?
A7. [함수명: 전체복사 / 얕은복사만]
```

→ Q6에서 "수정함" → Copy-on-Write 적용 (복사 → 수정 → 리턴)
→ Q7에서 "얕은복사만" → 중첩 경로 전체 복사로 수정

---

## PHASE 4: 외부 경계 검증

```
Q8. 서드파티/외부 라이브러리에 내부 데이터를 그대로 넘기는가?
A8. [있음 / 없음]

Q9. 외부 라이브러리의 리턴값을 그대로 내부에서 사용하는가?
A9. [있음 / 없음]
```

→ Q8/Q9에서 "있음" → 입력/출력 모두 deepCopy 적용

---

## PHASE 5: 추상화 레벨 검증

```
Q10. 액션 함수 안에 비즈니스 로직(계산)이 섞여 있는가?
A10. [함수명: 섞여있음 / 분리됨]

Q11. 한 함수 안에 저수준(for, 인덱스 탐색)과 고수준(비즈니스 호출)이 함께 있는가?
A11. [함수명: 혼재 / 균일]

Q12. DOM 업데이트와 비즈니스 로직이 같은 함수에 있는가?
A12. [함수명: 혼재 / 분리됨]
```

→ 각 "혼재/섞여있음" 항목 → 레벨별로 함수 분리

---

## PHASE 6: 중복 패턴 검증

```
Q13. 이름만 다르고 구현이 거의 동일한 함수가 2개 이상 있는가?
A13. [있음 — 목록화 / 없음]

Q14. Copy-on-Write 패턴(복사→수정→리턴)이 3회 이상 반복되는가?
A14. [있음 / 없음]
```

→ Q13 "있음" → 암묵적 인수를 명시적 인자로 올려 통합
→ Q14 "있음" → withArrayCopy / withObjectCopy 고차함수로 추출

---


## Scenario Validation (Mandatory)
- 검증 단계에서 작업 루트 `.project/scenario.md`를 반드시 확인한다.
- 아래를 점검한다.
  - 파일 존재 여부
  - 각 항목이 `명령 | 실행/변경 파일 | 파생 결과` 한 줄 형식인지
  - 실제 수정/실행 내용이 scenario 항목과 모순되지 않는지
- scenario 누락/불일치 시 검증을 통과로 보고하지 않는다.

## PHASE 7: 최종 확인

모든 수정 완료 후 아래에 답한다.

```
Q15. 수정된 항목 목록:
A15. [수정 없음 / 수정된 항목과 적용한 변환 명시]

Q16. 수정 후에도 원래 요구사항(design.md의 Done Criteria)을 만족하는가?
A16. [만족 / 불만족 — 불만족이면 이유 명시]

Q17. `.project/scenario.md`가 존재하고, 실제 실행/변경과 항목이 일치하는가?
A17. [일치 / 불일치 — 불일치이면 항목 명시]
```

→ Q16 "불만족"이면 → 요구사항을 깨지 않는 방향으로 재수정 후 PHASE 7 재실행
→ Q17 "불일치"이면 → scenario 업데이트 또는 구현/검증 재실행 후 PHASE 7 재실행
